<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css">
  <title>Пример 18 - Опережающая и ретроспективная проверка</title>
</head>
<body>

  <script>
    // Статья: https://learn.javascript.ru/regexp-lookahead-lookbehind
    // В некоторых случаях нам нужно найти соответствия шаблону, но только те, за которыми или перед которыми следует другой шаблон.
    // Для этого в регулярных выражениях есть специальный синтаксис: опережающая (lookahead) и ретроспективная (lookbehind) проверка.

    // Опережающая проверка
    // Синтаксис опережающей проверки: X(?=Y).
    // Он означает: найди X при условии, что за ним следует Y. Вместо X и Y здесь может быть любой шаблон.
    // Обратим внимание, что проверка – это именно проверка, содержимое скобок (?=...) не включается в результат

    console.log("Цена 14 1255$, текст цена 2".match(/\d+(?=\$)/));
    // ['1255', index: 8, input: 'Цена 14 1255$, текст цена 2', groups: undefined]
    // \d+ : найти цифры (0-9) любое количество от 1 до бесконечности
    // (?=\$) : опережающая проверка на то, что дальше идёт ли сразу символ $ слитно без всяких пробелов. $ экранирован, без экранирования \$ получим null

    // При поиске X(?=Y) движок регулярных выражений, найдя X, проверяет есть ли после него Y. Если это не так, то игнорирует совпадение и продолжает поиск дальше.
    // Возможны и более сложные проверки, например X(?=Y)(?=Z) означает, что мы ищем X при условии, что за ним идёт и Y и Z.
    // Найти X.
    // Проверить, идёт ли Y сразу после X (если нет – не подходит).
    // Проверить, идёт ли Z сразу после X (если нет – не подходит).
    // Если обе проверки прошли – совпадение найдено.
    console.log("1 индейка стоит 30".match(/\d+(?=\s)(?=.*30)/)); // ['1', index: 0, input: '1 индейка стоит 30', groups: undefined]
    // найдено число 1
    // \d+ : найти цифры (0-9) любое количество от 1 до бесконечности
    // (?=\s) : сразу после числа должен идти пробел
    // (?=.*30) : после может идти любое количество символов за которыми следует число 30

    // Негативная опережающая проверка
    // Синтаксис: X(?!Y)
    // Он означает: найди такой X, за которым НЕ следует Y.

    console.log("Цена 5$ или 50 или 500Р".match(/\d+(?!\$)/)); // ['50', index: 12, input: 'Цена 5$ или 50 или 500Р', groups: undefined]
    // Получили 50 так как это единственное число первое по ходу поиска, сразу за которым нет знака $

    // Ретроспективная проверка
    // Браузерная совместимость с ретроспективной проверкой. Обратите внимание: Lookbehind не поддерживается в браузерах построенных не на движке V8, таких как Safari и Internet Explorer.
    // Опережающие проверки позволяют задавать условия на то, что «идёт после».
    // Ретроспективная проверка выполняет такую же функцию, но с просмотром назад. Другими словами, она находит соответствие шаблону, только если перед ним есть что-то заранее определённое.
    // Синтаксис:
    // Позитивная ретроспективная проверка: (?<=Y)X, ищет совпадение с X при условии, что перед ним ЕСТЬ Y.
    // Негативная ретроспективная проверка: (?<!Y)X, ищет совпадение с X при условии, что перед ним ЕСТЬ Y. (из за вопроса, угла влево и восклицательного знака глючит JS)

    // Чтобы протестировать ретроспективную проверку, давайте поменяем валюту на доллары США. Знак доллара обычно ставится перед суммой денег, поэтому для того чтобы найти $30, мы используем (?<=\$)\d+ – число, перед которым идёт $:
    console.log("Цена 2 коробок: $5 или 600 р".match(/(?<=\$)\d+/)); // ['5', index: 17, input: 'Цена 2 коробок: $5 или 500 р', groups: undefined]
    // Получили 5 (то что находиться справа за скобками условия)
    // (?<=\$)\d+ : Позитивная ретроспективная проверка : сначала идёт $(экранирован) потом идет число

    console.log("Цена 2 коробок: $5 или 600 р".match(/(?<!\$)\d+/g)); // ['2', index: 5, input: 'Цена 2 коробок: $5 или 600 р', groups: undefined]
    // Получили 2 (то что находиться справа за скобками условия)
    // (?<!\$)\d+ : Негативная ретроспективная проверка: ищем первое попавшееся число перед которым нет знака $
    // если поставить флаг g, то найдется (2) ['2', '600']

    // Скобочные группы |kr
    // Как правило, то что находится внутри скобок, задающих опережающую и ретроспективную проверку, не включается в результат совпадения.
    // Но в некоторых ситуациях нам может быть интересно захватить и то, что в проверке. Для этого нужно обернуть это в дополнительные скобки.
    console.log("Цена 5$ или 50 или 500Р".match(/\d+(?=(\$|kr))/));
    // (2) ['5', '$', index: 5, input: 'Цена 5$ или 50 или 500Р', groups: undefined]
    // получили 2 элемента массива: искомое число 5 и знак $, который участвовал в поиске (\$|kr) благодаря скобкам и ключевому слову |kr который пишется через знак ИЛИ |

  </script>
</body>
</html>