<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css">
  <title>Пример 18 - Календарь</title>
</head>

<body>
  <div class="container"></div>

  <script>
    function createCalendar(elem,year,month) {
      elem = document.querySelector(elem)
      //  Нам удобнее передавать в функцию нормальный человеческий месяц 9, а функция должна его преобразовать в месяц 8 для рассчетов JS в котором месяцы от 0 до 11, а наш Сентябрь соответствует числу 8 по JS-скриптовски
      let mon = month - 1 // -1 необходим чтобы создать правильную дату. Введя Сентябрь(9) должен создаться объект с датой Сент, а из-за сдвига JS по месяцам необходимо ввести 8 месяц (человеческий месяц -1). 
      let d = new Date(year, mon) // С помощью "констуктора дат" сгенерировали полную дату JS. Здесь у нас будет храниться дата, основанная на годе и месяце, которые будем передавать сами. Эту дату надо формировать потому что она создается самим JS согласно вшитому календарю, в котором уже прописаном что нужнное число такогото года такого месяца это например пятница, и не нужно самому это искать по какому-то внешнему календарю. К тому же это будет объект содержащий дату и с ним можно будет работать используя вшитые в него методы для работы с временем
      console.log(d) // Sun Sep 01 2024 00:00:00 GMT+0700 (GMT+07:00) Получили 1 сентября суббота (Saturday)
      
      // Если сформировать дату на месяце с номером 4 без вычитания, то получим:
      let d2 = new Date(year, month)
      console.log(d2); // Tue Oct 01 2024 00:00:00 GMT+0700 (GMT+07:00). Результат неправильный, должен быть 01 Сентября Вс, а не 01 Окт Вт. Это потому что мы в качестве значения подставили 9(сентябрь), но в JS 9 это октябрь так как отсчет начинается с нуля (как будто 9-ый по счету).

      // далее создадим переменную содержащую шаблонные литералы в которых в виде текста будет находиться код для создания таблицы
      let table = `
      <table>
        <caption>${month}.${year}</caption>
        <tr>
          <th>пн</th>
          <th>вт</th>
          <th>ср</th>
          <th>чт</th>
          <th>пт</th>
          <th>сб</th>
          <th>вс</th>
        </tr>
        <tr>
      ` 
      // <tr> в конце это мы создали новый ряд, но специально не закрыли его для того чтобы дописать туда новые сгенерированные значения
      // элемент caption должен идти сразу же после открывающегося тега <table>

      // Далее цикл, который заполняет в таблице первые дни недели до нашего дня пустыми ячейками. Сентябрь 2024 года начинается с 1 сентября и это Вс, поэтому нам нужно всё до этого числа заполнить пустыми ячейками
      console.log(getDay(d)); // Получили: 6
      for(let i = 0; i<getDay(d); i++) { // getDay здесь это нами созданная функция. Знак меньше(<) чтобы заполнять пустыми ячейками с нулевого начального дня До дня текущего дня недели (до 6-го дня (Вс) ) 
        table += '<td></td>' // добавляем ячейку таблицы td(table data cell) без содержимого
      }
      // Получили 6 пустых ячеек под Пн, Вт, Ср, Чт, Пт, Сб
      // getDay(d) это мы берем переменную d в которой содержится дата в виде объекта JS с уже измененным месяцем-1 и правильным с точки зрения JS календаря, и с помощью функции getDay получаем ЧИСЛО, соответсвующее Пн(0) до Вс(6)

      console.log(d.getDate()); // Получили: 1. JavaScript метод getDate() объекта Date возвращает числовое значение (1-31), которое соответствует дню месяца для указанной даты по местному времени.
      console.log(d.getMonth()); // Получили: 8. Метод getMonth применяется к объекту с датой и возвращает текущий месяц. Нумерация месяцев начинается с нуля.
      while(d.getMonth() == mon) { // Задаём ограничение, что цикл делаем пока находимся в текущем месяце, так как в цикле будем увеличивать день с 1 до конца месяца (как только мы прибавим день выше возможного, то система JS сработает автоисправление, что увеличит нам месяц и цикл остановится по условию ставшему false так как месяцы введённый и текущий не совпадут)
        table += '<td>' + d.getDate() + '</td>' // В таблицу, в которой открыта строка таблицы, добавляем ячейку td, в которую записывается день месяца в виде числа
        if(getDay(d) % 7 == 6) { // Если остаток от деления Числа дня недели (0-6) на 7 равен 6, то это день №6 то есть Вс последний день
          table += '</tr><tr>' // В результате как только видим, что находимся на воскресеньи, то в таблице закрываем Ряд, и открываем новый Ряд
        }
        d.setDate(d.getDate()+1) // Устанавливаем дату как "текущая дата + 1"
      }

      // Далее цикл, который заполняет в таблице последние дни недели начиная с нашего дня до конца недели (Вс) пустыми ячейками. Сентябрь 2024 года заканчивается 30 сентября и это Пн, поэтому нам нужно всё после этого числа заполнить пустыми ячейками
      console.log(getDay(d)) // Получили: 1. Хоть закончили мы и именно на понедельнике, но видим 1 (вторник) потому что у нас d.setDate(d.getDate()+1) выполняется после создания   последней ячейки
      if (getDay(d) != 0) { // Если текущий день не равен 0 (понедельнику), то делаем следующеее
        for(let i = getDay(d); i<7; i++) { // getDay здесь это нами созданная функция. Знак меньше(<) чтобы заполнять пустыми ячейками с теущего По последний день недели (по воскресенье включительно) 
        table += '<td></td>' // добавляем ячейку таблицы td(table data cell) без содержимого
      }
      }

      table += '</tr></table>' // Закрываем последния ряд и всю таблицу
      elem.innerHTML = table

    }
    
    
    // Функция, которая в качестве параметра получает на вход объект-дату в формате JS и на выход выдаёт нам дни недели с Пн(0) до Вс(6) вместо JavaScript_овских дней с Вс(0) по Сб(6):
    function getDay(date) { // здесь getDay это нами самими придуманное название функции, несмотря на то, что оно совпадает с встроенным существующим методом объекта Date
      let day = date.getDay() // getDay это стандартный метод у объекта. Метод getDay() - получить день недели в понимании JS - от 0 (Воскресенье) до 6 (суббота)
      if(day == 0) day = 7 // Если по внутреннему календарю JS текущий день это воскресенье, то по умолчанию JS нам выдаст результат число 0(Вс). Делаем чтобы как только попали на день 0 (Вс), то он стал днём 7. Все остальные дни согласно внутреннему календарю JS совпадают с человеческими Пн(1)-Сб(6). здесь мы передвинули как бы с первого места Воскресенье на послденее место за Субботой. 
      return day-1 // пишем вернуть "-1" потому что нам нужно подать на вход понедельник(1) и получить 0, подать пятницу(5) и получить 4, подать воскресенье(7) и получить 6
      // а можно было -1 не писать и не мудрить, а просто цикл for начать не с 0, а с человеческой 1  
    }

    createCalendar('body', 2024, 9) // 9 это август по человеческому
  </script>
</body>

</html>